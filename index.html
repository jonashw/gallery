<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Gallery</title>
	<script type="text/javascript" src="/universal/javascript/jQuery.js"></script>	
	<script type="text/javascript" src="viewer.js"></script>
	<script>
		var viewer = new ImageViewer();
		var $imageContainer;
		//example UI stuff (should remain separate from core)
		$(function(){
			//initialize the image pool from the DOM.  hide all original images
			$imageContainer = $('#imageContainer');
			viewer.$imageContainer = $imageContainer;
			var images = [];
			$('img').each(function(){
				var $i = $(this);
				var image = new Image();
				image.src = $i.attr('src');
				images.push($(image));
				$i.remove();
			});
			viewer.images = images;
			//window resize listener -> image best-fit
			$(window).on('resize',function(){
				viewer.sizeToFit();
			});
			var stateChangeEvents = 'wrapChanged zoom unzoom slideShowStop slideShowStart open close imageLoaded';
			$imageContainer.on(stateChangeEvents, function(){
				$imageContainer.trigger('stateChange');
			});
		});
		$(function(){
			var openBtn = $("#open");
			var closeBtn = $("#close");
			var prevBtn = $("#prev");
			var nextBtn = $("#next");
			var zoomBtn = $("#zoom");
			var unzoomBtn = $("#unzoom");
			var hud = $("#hud").hide();
			var wrapCheck = $("#wrap");
			var start = $("#slideshow-start");
			var stop = $("#slideshow-stop");
			updateUIState();
			openBtn.on('click',function(){
				viewer.open();
			});
			closeBtn.on('click',function(){
				viewer.close();
			});
			prevBtn.on('click',function(){
				viewer.prevImage();
			});
			nextBtn.on('click',function(){
				viewer.nextImage();
			});
			zoomBtn.on('click',function(){
				viewer.zoom();
			});
			unzoomBtn.on('click',function(){
				viewer.unzoom();
			});
			wrapCheck.on('change',function(){
				viewer.setWrapAround($(this).is(':checked'));
			});
			start.on('click',function(){
				viewer.startSlideShow();
			});
			stop.on('click',function(){
				viewer.stopSlideShow();
			});
			$imageContainer
				.on('imageLoaded',function(e,image){
					console.log(image);
					hud.text('Viewing ' + (viewer.currentIndex() + 1) + ' of ' + viewer.imageCount());
				})
				.on('open',function(){
					console.log('open detected');
				})
				.on('stateChange',function(){
					console.log('detected state change');
					console.log(viewer.canOpen());
					updateUIState();
				})
				.on('click','img',function(e){
					viewer.canZoom() ? viewer.zoom() : viwer.unzoom();
				})
			;
			//keyboard navigation listener (arrow keys)
			$(document).on('keydown',function(e){
				console.log(e.which);
				switch(e.which){
					case 39://right
						viewer.nextImage();
						e.preventDefault();
						break;
					case 37: //left
						viewer.prevImage();
						e.preventDefault();
						break;
					case 38: //up	
						viewer.zoom();	
						break;
					case 40: //down
						viewer.unzoom();
						break;
					case 27: //esc
						viewer.close();
						break;
				}
			})
			//core UI functions
			function setEnabledTo($el,b){
				if(b){
					$el.removeAttr('disabled');
				} else {
					$el.attr('disabled','true');
				}
			}
			function setShownTo($el,b){
				if(b){
					$el.show();
				} else {
					$el.hide();
				}
			}
			function setChecked($el,b){
				if(b){
					$el.prop('checked',true);
				} else {
					$el.prop('checked',false);
				}
			}
			function updateUIState(){
				setEnabledTo(closeBtn, viewer.canClose());
				setEnabledTo(openBtn, viewer.canOpen());
				setEnabledTo(zoomBtn, viewer.canZoom());
				setEnabledTo(unzoomBtn, viewer.canUnzoom());
				setEnabledTo(prevBtn, viewer.canPrev());
				setEnabledTo(nextBtn, viewer.canNext());
				setEnabledTo(start, viewer.canStartSlideShow());
				setEnabledTo(stop, viewer.canStopSlideShow());
				setShownTo(hud, viewer.isOpen());
				setChecked(wrapCheck, viewer.canWrap());
			}
		});
	</script>
	<style>
		body { margin:0; padding:0; }
	</style>
</head>
<body>
	<div style="line-height:1.5em; padding:1em; margin:1em; text-align:center; width:150px; float:left; background:rgba(200,200,100,0.3); border-radius:4px; box-shadow:1px 1px #eee,inset 1px 1px #fff; border:1px solid #ddd">
		<button id="open">Open viewer</button>
		<br>
		<button id="close">Close viewer</button>
		<br>
		<br>
		<button id="prev">&#8592; Prev</button>
		<button id="next">Next &#8594;</button>
		<br>
		<br>
		Zoom
		<button id="zoom">+</button>
		<button id="unzoom">-</button>
		<br>
		<br>
		<label><input type="checkbox" id="wrap"> Wrap mode</label>
		<br>
		<br>
		<div id="hud"></div>
		Slideshow
		<br>
		<button id="slideshow-start">Start</button>
		<button id="slideshow-stop">Stop</button>
	</div>
	<div id="imageContainer"></div>
	<div id="images">
		<img src="img/1.jpg" alt="" />
		<img src="img/2.jpg" alt="" />
		<img src="img/3.jpg" alt="" />
		<img src="img/4.jpg" alt="" />
		<img src="img/5.jpg" alt="" />
		<img src="img/6.jpg" alt="" />
		<img src="img/7.jpg" alt="" />
		<img src="img/8.jpg" alt="" />
		<img src="img/9.jpg" alt="" />
		<img src="img/10.jpg" alt="" />
		<img src="img/11.jpg" alt="" />
		<img src="img/12.jpg" alt="" />
		<img src="img/13.jpg" alt="" />
		<img src="img/14.jpg" alt="" />
		<img src="img/15.jpg" alt="" />
		<img src="img/16.jpg" alt="" />
		<img src="img/17.jpg" alt="" />
	</div><!-- /images -->
</body>
</html>
